{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayPrototype = Array.prototype;\n\nlet arrayPrototype = Object.create(oldArrayPrototype);\n// vue2重写了7个方法，不是代理，所以监听不到索引和数组长度\nlet methods = [\"push\", \"pop\", \"shift\", \"unshift\", \"reverse\", \"sort\", \"splice\"];\nmethods.forEach((method) => {\n  // 用户调用方法会先经历重写的方法，之后再调用数组原来的方法\n  arrayPrototype[method] = function (...args) {\n    let inserted;\n    let ob = this.__ob__;\n    switch (method) {\n      case \"push\":\n      case \"unshift\":\n        inserted = args;\n        break;\n      case \"splice\": // arr.splice(1,1,xxx) => 只要最后的参数\n        inserted = args.slice(2);\n      default:\n        break;\n    }\n    if (inserted) {\n      // 对新增的数据再次进行观测\n      ob.observeArray(inserted);\n    }\n    oldArrayPrototype[method].call(this, ...args);\n  };\n});\n\nexport default arrayPrototype;\n","import arrayPrototype from \"./array\";\n\nclass Observe {\n  constructor(data) {\n    // __ob__标识已被观测过\n    Object.defineProperty(data, \"__ob__\", {\n      value: this,\n      enumerable: false, // 不可枚举\n    });\n    if (Array.isArray(data)) {\n      data.__proto__ = arrayPrototype;\n      this.observeArray(data);\n    } else {\n      this.walk(data);\n    }\n  }\n  observeArray(data) {\n    data.forEach((item) => observe(item));\n  }\n  walk(data) {\n    let keys = Object.keys(data);\n    keys.forEach((key) => {\n      // defineProperty实现响应式数据\n      defineReactive(data, key, data[key]);\n    });\n  }\n}\n\n// 性能不好：由于value可能是个对象，所以会进行递归。所有属性会被重新定义\nfunction defineReactive(data, key, value) {\n  //闭包+属  性劫持\n  observe(value);\n  Object.defineProperty(data, key, {\n    get() {\n      return value;\n    },\n    set(newValue) {\n      if (newValue === value) return;\n      observe(value);\n      value = newValue;\n    },\n  });\n}\n\nexport function observe(data) {\n  if (typeof data !== \"object\" || data == null) {\n    return;\n  }\n  if (data.__ob__) {\n    return data;\n  }\n  return new Observe(data);\n}\n","import { observe } from \"./observe/index\";\nexport default function initState(vm) {\n  const options = vm.$options;\n  if (options.data) {\n    initData(vm);\n  }\n}\n\nfunction proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key];\n    },\n    set(newValue) {\n      vm[source][key] = newValue;\n    },\n  });\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data;\n  // 是函数就拿函数的返回值 否则直接拿data\n  data = vm._data = typeof data === \"function\" ? data.call(vm) : data;\n  // 对vm._data进行代理，用户可以通过vm.xxx或者vm._data.xxx取值\n  for (let key in data) {\n    proxy(vm, \"_data\", key);\n  }\n  observe(data);\n}\n","const ncname = `[a-zA-Z][\\\\-\\\\.0-9_a-zA-Z]*`;\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 匹配到的分组是一个开始标签名，如 <div 或带命名空间的 <div:xxx，注意不带 > 符号\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配的是结束标签，如 </div>\n// 匹配属性，第一个分组是属性的 key，第二个分组是 = 号，第三、四、五分组是属性的 value 值\nconst attribute =\n  /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配开始标签的 > 符号或自闭和标签，如 <div> 中的 > 或 <br />\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // 匹配 {{}} 表达式，如 {{ name }}\n\nfunction parseHtml(html) {\n  function advance(n) {\n    html = html.substring(n);\n  }\n  while (html) {\n    let textEnd = html.indexOf(\"<\");\n    if (textEnd === 0) {\n      parseStarTag(); // 解析开始标签\n      break;\n    }\n  }\n  function parseStarTag() {\n    const matches = html.match(startTagOpen);\n    if (matches) {\n      const match = {\n        tagName: matches[1],\n        attrs: [],\n      };\n      advance(matches[0].length);\n      // 继续解析开始标签的属性\n      let end;\n      let attr;\n      // 没有匹配到结束标签就一直匹配\n      // 没有值默认就是true <div disabled></div> =>disabled = true\n      while (\n        !(end = html.match(startTagClose)) &&\n        (attr = html.match(attribute))\n      ) {\n        match.attrs.push({\n          name: attr[1],\n          value: attr[3] || attr[4] || attr[5] || true,\n        });\n        advance(attr[0].length); // 解析完就进行删除\n      }\n      if (end) {\n        advance(end[0].length);\n      }\n      console.log(html, match);\n    }\n  }\n}\n\nexport function compilerToFunction(template) {\n  let ast = parseHtml(template); // 将 template 转化成 ast 语法树\n  console.log(ast);\n}\n","import initState from \"./state\";\nimport { compilerToFunction } from \"./compiler/index\";\nexport default function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    // 将options绑定到实例中\n    vm.$options = options;\n    initState(vm);\n\n    // 初始化完毕进行页面挂载\n    if (vm.$options.el) {\n      vm.$mount(vm.$options.el);\n    }\n  };\n\n  Vue.prototype.$mount = function (el) {\n    const vm = this;\n    el = document.querySelector(el);\n    const options = vm.$options;\n    // 先判断是否有render函数，没有判断是否有template，没有最后用outerHtml作为template\n    // 然后把template转成render\n    if (!options.render) {\n      let template = options.template;\n      if (!template) {\n        template = el.outerHTML;\n      }\n\n      const render = compilerToFunction(template);\n      options.render = render;\n    }\n  };\n}\n","import initMixin from \"./init\";\n// 构造函数\nfunction Vue(options) {\n  this._init(options);\n}\n\ninitMixin(Vue);\n\nexport default Vue;\n"],"names":["oldArrayPrototype","Array","prototype","arrayPrototype","Object","create","methods","forEach","method","_oldArrayPrototype$me","inserted","ob","__ob__","_len","arguments","length","args","_key","slice","observeArray","call","apply","concat","Observe","data","_classCallCheck","defineProperty","value","enumerable","isArray","__proto__","walk","_createClass","key","item","observe","keys","defineReactive","get","set","newValue","_typeof","initState","vm","options","$options","initData","proxy","source","_data","ncname","qnameCapture","startTagOpen","RegExp","attribute","startTagClose","parseHtml","html","advance","n","substring","textEnd","indexOf","parseStarTag","matches","match","tagName","attrs","end","attr","push","name","console","log","compilerToFunction","template","ast","initMixin","Vue","_init","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}